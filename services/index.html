<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="utf-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <meta name="description" content="laminas-di integration for laminas-servicemanager">  
    <link rel="canonical" href="https://docs.laminas.dev/laminas-servicemanager-di/services/">
    <link rel="shortcut icon" href="https://docs.laminas.dev/img/trademark-laminas-foundation-rgb.svg">

    <title>Services - laminas-servicemanager-di - Laminas Docs</title>

    <link rel="stylesheet" href="https://docs.laminas.dev/css/styles.css">
</head>
<body id="page-top" class="components">

    
    <nav class="navbar navbar-expand-lg navbar-dark bg-primary">
    <div class="container">
        
        <a class="logo-link navbar-brand offset-md-2" href="https://getlaminas.org/" data-tooltip data-placement="bottom" title="Go to the Laminas homepage">
            <img src="https://docs.laminas.dev/img/laminas-foundation-white.svg" height="28" alt="Laminas">
        </a>
        <a class="navbar-title" href="https://docs.laminas.dev/" data-tooltip data-placement="bottom" title="Go to the Laminas Documentation">
            Documentation
        </a>

        
        <button type="button" class="navbar-toggler" data-toggle="collapse" data-target="#navbarSupportedContent" aria-controls="navbarSupportedContent" aria-expanded="false" aria-label="Toggle navigation">
            <span class="navbar-toggler-icon"></span>
        </button>

        <div class="collapse navbar-collapse" id="navbarSupportedContent">

            
            <ul class="navbar-nav ml-auto">
                <li class="nav-item">
                    <div class="dropdown">
                        <a class="dropdown-toggle nav-link" data-toggle="dropdown" aria-expanded="false">
                            All Docs
                        </a>
                        <div class="dropdown-menu" aria-labelledby="dropdownMenuButton">
                            <a class="dropdown-item" href="https://docs.laminas.dev/components">Components</a>
                            <a class="dropdown-item" href="https://docs.mezzio.dev/">Mezzio</a>
                            <a class="dropdown-item" href="https://api-tools.getlaminas.org/">API Tools</a>
                            <a class="dropdown-item" href="https://docs.laminas.dev/mvc">MVC</a>
                        </div>
                    </div>
                </li>
                <li class="nav-item">
                    <a href="https://getlaminas.org/participate" class="nav-link">Community</a>
                </li>
            </ul>

            
            
                <div class="d-block d-sm-none">
                    
    <div class="subnavigation hidden-print">
        <h4 class="subnavigation__title">
            <a href="..">laminas-servicemanager-di</a>
        </h4>

        <h5 class="subnavigation__subtitle">Table of Contents</h5>

        <ul class="subnavigation__list">
            

                
                

                    
                    
                        
                            <li class="subnavigation__list-item subnavigation__list-item--active">
                                <a href="./" class="subnavigation__link">Services</a>
                            </li>
                        
                    
                
            

                
                

                    
                    
                        
                            <li class="subnavigation__list-item">
                                <span class="subnavigation__headline">Migration</span>
                                <ul class="subnavigation__list">
                                    
                                        
    <li class="subnavigation__list-item ">
        <a href="../migration/v2-to-v3/" class="subnavigation__link">Version 2 to Version 3</a>
    </li>

                                    
                                </ul>
                            </li>
                        
                    
                
            
        </ul>
    </div>

                </div>
            

            
            <div class="d-block d-sm-none">
                <div class="component-selector">
    
    <h5 class="component-selector__subtitle">Find documentationâ€¦</h5>
    <select class="form-control component-selector__control">
        <option value="/">Overview</option>
        <optgroup label="Components"></optgroup>
    </select>
</div>
            </div>
        </div>
    </div>
</nav>

    
    <header class="header">
    <div class="container">
        <div class="row">

            
            <div class="col-6 offset-md-2">
                <h1 class="header__title">
                    Components

                    
                        <small class="header__subtitle">laminas-servicemanager-di</small>
                    
                </h1>
            </div>

            
            <div class="col-4 text-sm-right">
                
                    

                    <a href="#" class="header__link header__link--search" data-toggle="modal" data-target="#mkdocs_search_modal" title="Open search">
                        <i class="fa fa-search"></i> Search
                    </a>
                    <a href="https://github.com/laminas/laminas-servicemanager-di/" class="header__link header__link--github" title="Go to repository of laminas-servicemanager-di">
                        <i class="fa fa-github"></i> GitHub
                    </a>
                
            </div>
        </div>
    </div>
</header>

    
    <div class="container">
        <div class="row">
            <div class="col-md-2 col-sm-12">
                
                
                    
    

    
    
        <div class="toc">
            <h6 class="toc__headline">On this page</h6>
            <ul class="toc__list">
                
                    <li class="toc__entry">
                        <a href="#difactory" class="toc__link">DiFactory</a>
                    </li>
                
                    <li class="toc__entry">
                        <a href="#diservicefactory" class="toc__link">DiServiceFactory</a>
                    </li>
                
                    <li class="toc__entry">
                        <a href="#diabstractservicefactory" class="toc__link">DiAbstractServiceFactory</a>
                    </li>
                
                    <li class="toc__entry">
                        <a href="#districtabstractservicefactory" class="toc__link">DiStrictAbstractServiceFactory</a>
                    </li>
                
                    <li class="toc__entry">
                        <a href="#diserviceinitializer" class="toc__link">DiServiceInitializer</a>
                    </li>
                
            </ul>
        </div>
    

                
            </div>
            <div class="col-md-7 col-sm-12 content" role="main" data-spy="scroll" data-target=".toc">
                
                    <nav aria-label="breadcrumb">
    <ol class="breadcrumb">
        
            <li class="breadcrumb-item"><a href="https://docs.laminas.dev/">Overview</a></li>
            <li class="breadcrumb-item"><a href="https://docs.laminas.dev/components/">Components</a></li>

            
                <li class="breadcrumb-item"><a href="..">laminas-servicemanager-di</a></li>

                

                <li class="breadcrumb-item active" aria-current="page">Services</li>
            
        
    </ol>
</nav>






    
    

    <h1 id="services-provided">Services Provided</h1>
<p>laminas-servicemanager-di provides a number of factories and services that
integrate <a href="https://github.com/laminas/laminas-di">laminas-di</a> into
<a href="https://docs.laminas.dev/laminas-servicemanager/">laminas-servicemanager</a>.
The following lists each, and details:</p>
<ul>
<li>whether or not they are registered by default; and</li>
<li>how to enable them if not.</li>
</ul>
<h2 id="difactory">DiFactory</h2>
<p><code>Laminas\ServiceManager\Di\DiFactory</code> creates and returns a <code>Laminas\Di\Di</code> instance.
If the <code>config</code> service is present, and contains a top-level <code>di</code> key, the value
of that key will be used to seed a <code>Laminas\Di\Config</code> instance, which will then in
turn be used to configure the <code>Di</code> instance.</p>
<p>By default, this factory is mapped to the service name <code>DependencyInjector</code>, and
aliased to <code>Di</code>.</p>
<p>Configuration for the service should follow the rules for
<a href="https://docs.laminas.dev/laminas-di/config/"><code>Laminas\Di\Config</code></a>.</p>
<h2 id="diservicefactory">DiServiceFactory</h2>
<p><code>Laminas\ServiceManager\Di\DiServiceFactory</code> provides a laminas-di-backed factory that
will use the name provided and attempt to create the relevant object instance.</p>
<p>The constructor accepts three arguments:</p>
<ul>
<li><code>$di</code>, a <code>Laminas\Di\Di</code> instance.</li>
<li><code>$useContainer</code>, one of the class constants <code>USE_SL_BEFORE_DI</code>,
  <code>USE_SL_AFTER_DI</code>, <code>USE_SL_NONE</code>, as detailed below.</li>
</ul>
<p>The factory composes the <code>Di</code> instance, and uses the <code>$useContainer</code> value to
determine how to attempt to create the instance, according to the following
rules:</p>
<ul>
<li>If <code>USE_SL_BEFORE_DI</code> is provided, the factory will attempt to fetch the service
  from the passed container first, and fall back to the composed DI container
  only on failure.</li>
<li>If <code>USE_SL_AFTER_DI</code> is provided, the factory will attempt to fetch the service
  from the composed DI container first, and fall back to the passed container
  only on failure.</li>
<li>If <code>USE_SL_NONE</code> is provided (or no argument is passed), then the factory will
  only fetch from the composed DI container.</li>
</ul>
<p>While you can use the factory directly, doing so requires seeding it with a
configured <code>Di</code> instance. In most cases, you will use the
<code>DiAbstractServiceFactory</code> instead, as detailed in the next section.</p>
<h2 id="diabstractservicefactory">DiAbstractServiceFactory</h2>
<p><code>Laminas\ServiceManager\Di\DiAbstractServiceFactory</code> provides an <a href="http://docs.laminas.dev/laminas-servicemanager/configuring-the-service-manager/#abstract-factories">abstract
factory</a>
that will, on invocation, pull the requested class from the composed
<code>Laminas\Di\Di</code> instance. It extends <code>DiServiceFactory</code> to provide the utilities
necessary to act as an abstract factory.</p>
<p>When determining if a requested service can be created, it does the following,
in the following order:</p>
<ul>
<li>Checks if a shared instance is already present for the requested service in
  the DI instance manager.</li>
<li>Checks if an alias exists for the requested service in the DI instance
  manager.</li>
<li>Checks if configuration exists for the requested service in the DI instance
  manager.</li>
<li>Checks if type preferences exist for the requested service in the DI instance
  manager.</li>
</ul>
<p>If none of the above return true, it then:</p>
<ul>
<li>checks if a class definition exists for the requested service;</li>
<li>checks if the requested service is an interface name.</li>
</ul>
<p>If none of the above return true, it will not attempt to create the requested
service.</p>
<p>If the service can be created, creation follows the rules outlined for the
<a href="#diservicefactory">DiServiceFactory</a>.</p>
<p><code>DiAbstractServiceFactory</code> is registered under the service name
<code>DiAbstractServiceFactory</code> by default. To register it as an abstract factory in
your code, you will need to manually register it. This will typically be done
via one of your application modules, within the <code>onBootstrap()</code> method:</p>
<pre class=codehilite><code class=language-php>class Module
{
    public function onBootstrap($e)
    {
        $app = $e-&gt;getTarget();
        $services = $app-&gt;getServiceManager();

        $services-&gt;addAbstractFactory($services-&gt;get('DiAbstractServiceFactory'));
    }
}</code></pre>
<p>This should typically be done in a module registered early, to ensure it happens
before many services are pulled from the container.</p>
<h2 id="districtabstractservicefactory">DiStrictAbstractServiceFactory</h2>
<p><code>Laminas\ServiceManager\Di\DiStrictAbstractServiceFactory</code> works similarly to
<code>DiAbstractServiceFactory</code> and <code>DiServiceFactory</code>, with a few key differences.</p>
<p>First, unlike <code>DiAbstractServiceFactory</code>, it directly extends <code>Laminas\Di\Di</code>; as
such, it acts exactly like <code>Laminas\Di\Di</code>, except where it specifically overloads
functionality. Second, it implements a <em>whitelist</em>; if the requested class does
not exist in the whitelist, the abstract factory will not attempt to create an
instance. This latter is useful for creating a <em>scoped</em> <code>Di</code> instance. As an
example, when pulling controllers, you may be tempted to use a <code>:controller</code>
segment in your routing; having a whitelist ensures that if a user requests an
arbitrary classname for the controller, the abstract factory will not attempt to
create an instance!</p>
<p><code>DiStrictAbstractServiceFactory</code> is registered under the service name
<code>DiStrictAbstractServiceFactory</code> by default. To register it as an abstract factory in
your code, you will need to manually register it. This will typically be done
via one of your application modules, within the <code>onBootstrap()</code> method:</p>
<pre class=codehilite><code class=language-php>class Module
{
    public function onBootstrap($e)
    {
        $app = $e-&gt;getTarget();
        $services = $app-&gt;getServiceManager();

        $services-&gt;addAbstractFactory($services-&gt;get('DiStrictAbstractServiceFactory'));
    }
}</code></pre>
<p>This should typically be done in a module registered early, to ensure it happens
before many services are pulled from the container.</p>
<p>By default, <code>DiStrictAbstractServiceFactory</code> is consumed by
<code>Laminas\Mvc\Controller\ControllerManager</code>; if the abstract factory is detected, it
is added as an abstract factory to the <code>ControllerManager</code> instance.</p>
<p>Thsu, by default, the factory for building the <code>DiStrictAbstractServiceFactory</code>
instance checks for configuration under <code>di.allowed_controllers</code>; this should
be an array of controller names to add to the service:</p>
<pre class=codehilite><code class=language-php>return [
    'di' =&gt; [
        'allowed_controllers' =&gt; [
            'Some\Controller\Name',
        ],
    ],
];</code></pre>
<p>You can use <code>DiStrictAbstractServiceFactory</code> in other locations as well, and
with other configuration. Consider using <a href="http://docs.laminas.dev/laminas-servicemanager/delegators/">delegator factories</a>
in order to seed the <code>DiStrictAbstractServiceFactory</code>:</p>
<pre class=codehilite><code class=language-php>public function __invoke(ContainerInterface $container, $name, callable $callback, array $options = null)
{
    $diStrictAbstractFactory = $callback();

    $config = $container-&gt;has('config') ? $container-&gt;get('config') : [];

    if (! isset($config['application_di_class_whitelist'])) {
        return $diStrictAbstractFactory;
    }

    $diStrictAbstractFactory-&gt;setAllowedServiceNames($config['application_di_class_whitelist']);
    return $diStrictAbstractFactory;
}</code></pre>
<h2 id="diserviceinitializer">DiServiceInitializer</h2>
<p><code>Laminas\ServiceManager\Di\DiServiceInitializer</code> is a laminas-servicemanager
<a href="http://docs.laminas.dev/laminas-servicemanager/configuring-the-service-manager/#initializers">initializer</a>,
and can be used to initialize instances after they've already been pulled from
the container. This functionality can work with invokable services, or to
augment existing factories in your laminas-servicemanager configuration.</p>
<p>Because the initializer requires a <code>Laminas\Di\Di</code> instance, as well as the parent
application container, it is registered with laminas-servicemanager, and you will
need to retrieve it and add it as an initializer manually, typically in an
application module's <code>onBootstrap()</code> method:</p>
<pre class=codehilite><code class=language-php>class Module
{
    public function onBootstrap($e)
    {
        $app = $e-&gt;getTarget();
        $services = $app-&gt;getServiceManager();

        $services-&gt;addInitializer($services-&gt;get('DiServiceInitializer'));
    }
}</code></pre>
<p>We do not recommend using this functionality, as initializers are run for every
new instance retrieved, and the functionality could conflict with existing
factories for services.</p>




    <nav>
    <ul class="page-nav hidden-print">

        
        <li class="page-nav__item">
            
                <a rel="prev" class="page-nav__link page-nav__link--prev" href="..">
                    <i class="fa fa-chevron-left"></i> Previous
                </a>
            
        </li>

        
        <li class="page-nav__item">
            
                <a rel="next" class="page-nav__link page-nav__link--next" href="../migration/v2-to-v3/">
                    Next <i class="fa fa-chevron-right"></i>
                </a>
            
        </li>
    </ul>
</nav>




    <div class="help-wanted">
        <p>
            Found a mistake or want to contribute to the documentation?
            <a href="https://github.com/laminas/laminas-servicemanager-di/edit/master/docs/book/services.md" target="_blank" class="help-wanted__link">
                Edit this page on GitHub!
            </a>
        </p>
    </div>

                
            </div>
            <div class="col-md-3 col-sm-12 sidebar">
                
                    <div class="component-selector">
    
    <h5 class="component-selector__subtitle">Find documentationâ€¦</h5>
    <select class="form-control component-selector__control">
        <option value="/">Overview</option>
        <optgroup label="Components"></optgroup>
    </select>
</div>
                    
    <div class="subnavigation hidden-print">
        <h4 class="subnavigation__title">
            <a href="..">laminas-servicemanager-di</a>
        </h4>

        <h5 class="subnavigation__subtitle">Table of Contents</h5>

        <ul class="subnavigation__list">
            

                
                

                    
                    
                        
                            <li class="subnavigation__list-item subnavigation__list-item--active">
                                <a href="./" class="subnavigation__link">Services</a>
                            </li>
                        
                    
                
            

                
                

                    
                    
                        
                            <li class="subnavigation__list-item">
                                <span class="subnavigation__headline">Migration</span>
                                <ul class="subnavigation__list">
                                    
                                        
    <li class="subnavigation__list-item ">
        <a href="../migration/v2-to-v3/" class="subnavigation__link">Version 2 to Version 3</a>
    </li>

                                    
                                </ul>
                            </li>
                        
                    
                
            
        </ul>
    </div>

                
            </div>
        </div>
    </div>

    
    <footer class="footer">
    <div class="container">

        
        <div class="row">
            <div class="col-md-12 text-center">
                <a class="footer__button" href="#page-top"><i class="fa fa-chevron-up" aria-hidden="true"></i></a>
            </div>
        </div>

        <div class="row">
            <div class="col-md-10 offset-md-2">
                <h5>Laminas</h5>
                <ul>
                    <li>Laminas Project <a href="https://getlaminas.org/">The new foundation for the community-supported, open source continuation of Zend Framework</a></li>
                    <li>Laminas Components and MVC <a href="https://docs.laminas.dev/">Components and MVC for enterprise applications</a></li>
                    <li>Mezzio <a href="https://docs.mezzio.dev/">PSR-15 middleware in minutes</a></li>
                    <li>Laminas API Tools <a href="https://api-tools.getlaminas.org/">Build RESTful APIs in minutes</a></li>
                </ul>
            </div>
        </div>

        <div class="row">
            <div class="col-md-10 offset-md-2"> 
                <div class="row">

                    
                    <div class="col-md-4">
                        <h4 class="footer__headline">Support</h4>
                        <ul class="support__list">
                            <li class="support__list-item">
                                <a href="https://discourse.laminas.dev" class="support__link" title="Forum"><i class="fa fa-comments"></i></a>
                            </li>
                            <li class="support__list-item">
                                <a href="https://laminas.dev/chat" class="support__link" title="Chat"><i class="fa fa-slack"></i></a>
                            </li>
                            <li class="support__list-item">
                                <a href="https://github.com/laminas" class="support__link" title="Github"><i class="fa fa-github"></i></a>
                            </li>
                            <li class="support__list-item">
                                <a href="https://twitter.com/getlaminas" class="support__link" title="Twitter"><i class="fa fa-twitter"></i></a>
                            </li>
                            <li class="support__list-item">
                                <a href="https://getlaminas.org/blog/feed-rss.xml" class="support__link" title="Blog feed"><i class="fa fa-rss"></i></a>
                            </li>
                            <li class="support__list-item">
                                <a href="https://getlaminas.org/security/feed" class="support__link" title="Security feed"><i class="fa fa-rss-square"></i></a>
                            </li>
                        </ul>
                    </div>

                    
                    <div class="col-md-4">
                        <h4 class="footer__headline">License</h4>
                        <p>
                            Code licensed under <a
                                href="https://github.com/laminas/laminas-servicemanager-di/blob/master/LICENSE.md">BSD 3-Clause</a>.
                        </p>
                    </div>

                    
                    <div class="col-md-4">
                        <h4 class="footer__headline">Copyright</h4>
                        <p>
                            <!--Built with love by the Laminas team with the help of our
                            <a href="https://github.com/laminas/laminas-servicemanager-di/graphs/contributors">contributors</a>.<br>-->
                            &copy; 2019-2020 by <a href="https://getlaminas.org/">The Laminas Project</a>.
                        </p>
                    </div>
                </div>
            </div>
        </div>
    </div>
</footer>

    <script>
        let base_url = '..',
            project  = "components",
            siteName = 'laminas-servicemanager-di';
    </script>
    <script src="https://docs.laminas.dev/js/scripts.js"></script>
        <script src="../search/main.js"></script>

    
    <div class="modal" id="mkdocs_search_modal" tabindex="-1" role="dialog" aria-labelledby="Search Modal" aria-hidden="true">
    <div class="modal-dialog" role="document">
        <div class="modal-content">
            <div class="modal-header">
                <h5 class="modal-title">Search</h5>
                <button type="button" class="close" data-dismiss="modal" aria-label="Close">
                    <span aria-hidden="true">&times;</span>
                    <span class="sr-only">Close</span>
                </button>
            </div>
            <div class="modal-body">
                <form role="form">
                    <div class="form-group">
                        <input type="text" class="form-control" placeholder="Search in laminas-servicemanager-di" id="mkdocs-search-query">
                    </div>
                </form>
                <div id="mkdocs-search-results"></div>
            </div>
        </div>
    </div>
</div>
</body>


</html>
